# 需求文档

## 简介

基于《斯波索宾和声学教程》的互动式和声连接学习游戏。该系统允许学生通过实践练习来学习和掌握和弦连接规则，涵盖教程第1-60章的所有内容。游戏提供即时反馈，帮助学生理解错误并改进技能。

## 术语表

- **系统（System）**: 和声游戏应用程序
- **玩家（Player）**: 使用游戏学习和声理论的用户
- **关卡（Level）**: 对应教程中一个章节的游戏单元，包含两个练习题
- **练习题（Exercise）**: 来自教程的具体和声连接习题
- **和弦进行（Chord_Progression）**: 玩家输入的一系列和弦
- **连接规则（Connection_Rule）**: 《斯波索宾和声学教程》中定义的和弦连接规范
- **验证引擎（Validation_Engine）**: 检查和弦进行是否符合连接规则的系统组件
- **分数（Score）**: 玩家在游戏中获得的积分

## 需求

### 需求 1: 关卡系统

**用户故事:** 作为玩家，我想要按章节顺序进行练习，以便系统地学习和声理论知识。

#### 验收标准

1. 系统 SHALL 提供恰好60个关卡，对应教材第1-60章
2. WHEN 玩家选择一个关卡，系统 SHALL 显示该章节对应的两个练习题
3. WHEN 玩家完成一个关卡中的两个练习题，系统 SHALL 解锁下一个关卡
4. 系统 SHALL 为每个关卡显示章节编号和标题
5. WHEN 玩家首次启动游戏，系统 SHALL 仅使第1关可访问

### 需求 2: 音符输入

**用户故事:** 作为玩家，我想要输入音符来构建和弦进行，以便完成练习题。

#### 验收标准

1. 系统 SHALL 提供输入单个音符的界面
2. WHEN 玩家输入音符，系统 SHALL 以标准五线谱记谱法显示它们
3. 系统 SHALL 允许玩家为多个声部（女高音、女低音、男高音、男低音）输入音符
4. WHEN 玩家输入一个音符，系统 SHALL 验证它与其他声部是否构成有效和弦
5. 系统 SHALL 允许玩家编辑或删除之前输入的音符

### 需求 3: 和弦连接规则验证

**用户故事:** 作为玩家，我想要系统验证我的和弦连接是否正确，以便了解我是否掌握了规则。

#### 验收标准

1. WHEN 玩家完成一个和弦进行，系统 SHALL 根据对应章节的所有适用连接规则进行验证
2. WHEN 所有连接规则都满足，系统 SHALL 给玩家加1分
3. WHEN 违反连接规则，系统 SHALL 识别所有违规情况但不扣分
4. 验证引擎 SHALL 检查常见错误，包括平行五度、平行八度、声部进行问题和重复音规则
5. 系统 SHALL 仅应用当前章节及之前章节引入的规则

### 需求 4: 错误反馈

**用户故事:** 作为玩家，我想要在犯错时收到清晰的解释，以便理解错误并改进。

#### 验收标准

1. WHEN 发生验证错误，系统 SHALL 显示具体的错误消息，解释违反了哪条规则
2. WHEN 显示错误，系统 SHALL 高亮显示违规涉及的具体音符或和弦
3. 系统 SHALL 为每个错误提供教材中相关章节的引用
4. WHEN 存在多个错误，系统 SHALL 同时显示所有错误
5. 系统 SHALL 在错误消息中使用清晰的教学语言

### 需求 5: 练习题管理

**用户故事:** 作为玩家，我想要练习来自教材的真实习题，以便与课程内容保持一致。

#### 验收标准

1. 系统 SHALL 为每个章节存储来自教材的练习题
2. WHEN 加载一个关卡，系统 SHALL 呈现对应章节的两个练习题
3. 系统 SHALL 显示练习题说明和任何给定的起始和弦
4. WHEN 练习题有特定约束条件，系统 SHALL 在输入期间强制执行这些约束
5. 系统 SHALL 在玩家完成或跳过练习题后提供正确答案供参考

### 需求 6: 计分系统

**用户故事:** 作为玩家，我想要追踪我的进度和分数，以便衡量我的学习成果。

#### 验收标准

1. 系统 SHALL 维护所有关卡的累计分数
2. WHEN 玩家正确完成一个练习题，系统 SHALL 给分数加1分
3. WHEN 玩家犯错，系统 SHALL 不扣分
4. 系统 SHALL 在游戏过程中显著地显示当前分数
5. 系统 SHALL 在会话之间保存玩家的分数和进度

### 需求 7: 游戏进度持久化

**用户故事:** 作为玩家，我想要保存我的游戏进度，以便可以在不同时间继续学习。

#### 验收标准

1. WHEN 玩家完成一个关卡，系统 SHALL 保存完成状态
2. WHEN 玩家返回游戏，系统 SHALL 恢复他们的进度和已解锁的关卡
3. 系统 SHALL 保存玩家的当前分数
4. WHEN 玩家在关卡进行中退出，系统 SHALL 允许他们从该关卡继续
5. 系统 SHALL 在玩家的设备上本地持久化数据

### 需求 8: 用户界面

**用户故事:** 作为玩家，我想要一个直观的界面，以便轻松地输入音符和查看反馈。

#### 验收标准

1. 系统 SHALL 显示用于音符输入和可视化的五线谱
2. WHEN 显示练习题，系统 SHALL 清晰地显示练习题编号和说明
3. 系统 SHALL 为正确和错误的和弦进行提供视觉反馈
4. 系统 SHALL 包含在练习题和关卡之间移动的导航控件
5. 系统 SHALL 显示关卡选择屏幕，显示已锁定和已解锁的关卡

### 需求 9: 音乐理论规则引擎

**用户故事:** 作为系统架构师，我想要一个可扩展的规则引擎，以便准确实现教材中的所有连接规则。

#### 验收标准

1. 验证引擎 SHALL 实现教材第1-60章的所有连接规则
2. WHEN 验证一个进行，验证引擎 SHALL 按正确顺序应用规则
3. 验证引擎 SHALL 支持不同章节的不同规则集
4. WHEN 新章节引入额外规则，验证引擎 SHALL 将这些规则添加到验证过程中
5. 验证引擎 SHALL 提供关于违反了哪条具体规则的详细信息

### 需求 10: 练习题数据结构

**用户故事:** 作为开发者，我想要一个清晰的数据结构来存储练习题，以便轻松添加和管理内容。

#### 验收标准

1. 系统 SHALL 定义用于存储练习题数据的结构化格式
2. WHEN 存储练习题，系统 SHALL 包含章节编号、练习题说明、起始和弦和预期答案
3. 系统 SHALL 支持具有不同和弦数量的练习题
4. 系统 SHALL 允许练习题指定应验证哪些规则
5. 系统 SHALL 以易于编辑和扩展的格式存储练习题数据
